# План реализации "Бот трекер активностей"

### `[x]` Этап 1: Настройка проекта и базы данных
- `[x]` **Инициализация проекта**: Создание структуры папок и файлов проекта.
- `[x]` **Установка зависимостей**: Установка `fastapi`, `aiogram`, `uvicorn`, `sqlalchemy` для работы с БД и `alembic` для миграций.
- `[x]` **Проектирование БД**:
    - `[x]` Создание таблицы `activities` для хранения активностей.
    - `[x]` Создание таблицы `activity_logs` для записи действий.
- `[x]` **Настройка миграций**: Инициализация `Alembic` для версионирования схемы базы данных.

### `[x]` Этап 2: Базовая логика бота и главное меню
- `[x]` **Настройка FastAPI и Webhook**: Создание базового приложения FastAPI и настройка вебхука.
- `[x]` **Обработчики команд**: Реализация обработчиков для команд `/start` и `/menu`.
- `[x]` **Главное меню**: Создание и отображение основной клавиатуры.

### `[x]` Этап 3: Функционал добавления и просмотра активностей
- `[x]` **Добавление активности**:
    - `[x]` Реализация inline-клавиатуры для выбора типа активности.
    - `[x]` Использование FSM для пошагового создания активности.
    - `[x]` Сохранение новой активности в базе данных.
- `[x]` **Список активностей**: Динамическое формирование inline-клавиатуры со списком всех добавленных активностей.

### `[x]` Этап 4: Механизм трекинга активностей
- `[x]` **Checkbox-активности**: Реализация логики для отметки (вкл/выкл).
- `[x]` **Time-активности**: Реализация кнопок "Старт" и "Стоп" и замера времени.

### `[x]` Этап 5: Экспорт данных в Markdown (старая версия)
- `[x]` **Выбор периода**: Реализация FSM-сценария для ручного ввода начальной и конечной даты.
- `[x]` **Формирование файлов**: Генерация и отправка `.md` файлов.

### `[x]` Этап 6: Просмотр статистики
- `[x]` **Выбор периода статистики**: Создание inline-клавиатуры с опциями.
- `[x]` **Агрегация данных**: Написание запросов к БД для подсчета статистики.
- `[x]` **Отображение**: Вывод отформатированной статистики пользователю.

---
### **Новые задачи и доработки**
---

### `[x]` Задача: Улучшение выбора дат (Календарь)
- `[x]` **Реализация клавиатуры-календаря**: Создание вспомогательных функций для генерации inline-клавиатуры в виде календаря.
- `[x]` **Интеграция в "Скачать исходники"**: Замена ручного ввода дат на интерактивный выбор с помощью календаря.

### `[x]` Задача: Исправление ошибки в просмотре статистики
- `[x]` **Анализ и исправление ошибки**: Устранение `AttributeError` в функции `get_stats_for_period` путем замены `func.cast` на более стабильную конструкцию `case`.

### `[x]` Задача: Изменение формата экспортируемого Markdown-файла
- `[x]` **Модификация шаблона**: Удаление заголовков "Заголовок:" и "Данные:" из генерируемых `.md` файлов, оставляя только блок с данными.
### `[x]` Задача: Привязка данных к пользователю
- `[x]` **Обновление моделей БД**: Добавить поле `user_id` в модель `Activity` и создать составной уникальный ключ `(user_id, name)`.
- `[x]` **Создание миграции**: Сгенерировать миграцию Alembic для обновления схемы базы данных.
- `[x]` **Обновление CRUD-операций**: Модифицировать все функции в `db/crud.py` для учета `user_id`.
- `[x]` **Обновление обработчиков**: Изменить хендлеры `aiogram` для передачи `user_id` в CRUD-операции.

### `[x]` Задача: Ручной ввод времени для time-активности
- `[x]` **Обновление клавиатуры**: Добавить кнопку "✏️" для ручного ввода минут.
- `[x]` **Создание FSM состояния**: Добавить состояние для ожидания ввода времени.
- `[x]` **Реализация обработчиков**: Создать обработчики для кнопки "✏️" и для введенного пользователем значения.

### `[x]` Задача: Добавление инструкций по использованию бота
- `[x]` **Создание нового хендлера**: Создать обработчик для команды `/help`, который будет отображать подробные инструкции по использованию бота.
- `[x]` **Интеграция в `main.py`**: Зарегистрировать новый роутер в основном файле приложения.
