### План реализации "Бот трекер активностей"

**Этап 1: Настройка проекта и базы данных**
1.  **Инициализация проекта**: Создание структуры папок и файлов проекта.
2.  **Установка зависимостей**: Установка `fastapi`, `aiogram`, `uvicorn`, `sqlalchemy` для работы с БД и `alembic` для миграций.
3.  **Проектирование БД**:
    *   Создание таблицы `activities` для хранения активностей (поля: `id`, `name`, `type` \['checkbox' или 'time']).
    *   Создание таблицы `activity_logs` для записи действий (поля: `id`, `activity_id`, `date`, `value_bool`, `value_minutes`).
4.  **Настройка миграций**: Инициализация `Alembic` для версионирования схемы базы данных.

**Этап 2: Базовая логика бота и главное меню**
1.  **Настройка FastAPI и Webhook**: Создание базового приложения FastAPI и настройка вебхука для интеграции с `aiogram`.
2.  **Обработчики команд**: Реализация обработчиков для команд `/start` и `/menu`.
3.  **Главное меню**: Создание и отображение основной клавиатуры с кнопками: "Добавить активность", "Активности", "Скачать исходники", "Просмотр статистики".

**Этап 3: Функционал добавления и просмотра активностей**
1.  **Добавление активности**:
    *   Реализация inline-клавиатуры для выбора типа активности (Checkbox/Time).
    *   Использование FSM (Finite State Machine) в `aiogram` для пошагового создания активности (запрос названия).
    *   Сохранение новой активности в базе данных.
2.  **Список активностей**: Динамическое формирование inline-клавиатуры со списком всех добавленных активностей.

**Этап 4: Механизм трекинга активностей**
1.  **Checkbox-активности**: Реализация логики для отметки (вкл/выкл). Состояние сохраняется с привязкой к текущей дате.
2.  **Time-активности**:
    *   Реализация кнопок "Старт" и "Стоп".
    *   Подсчет длительности интервалов в минутах.
    *   Суммирование и сохранение общего времени за текущий день.

**Этап 5: Экспорт данных в Markdown**
1.  **Выбор периода**: Реализация inline-клавиатуры в виде календаря для выбора начальной и конечной даты.
2.  **Формирование файлов**:
    *   Извлечение данных из БД за выбранный период.
    *   Генерация `.md` файлов для каждого дня в указанном формате.
    *   Отправка сгенерированных файлов пользователю в чат.

**Этап 6: Просмотр статистики**
1.  **Выбор периода статистики**: Создание inline-клавиатуры с опциями: "день", "неделя", "месяц", "выбор дат".
2.  **Агрегация данных**: Написание запросов к БД для подсчета статистики в зависимости от типа активности (количество отметок или сумма минут).
3.  **Отображение**: Вывод отформатированной статистики пользователю.
