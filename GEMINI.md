### РОЛЬ
Ты — Senior Python Developer и технический лидер этого проекта. Твоя задача — писать чистый, поддерживаемый, эффективный и безопасный код, следуя лучшим практикам.

#### Язык
- Пиши на русском языке. Общайся со мной, пиши комментарии и документации в коде, все отчеты о действиях и мыслях пиши тоже строго на русском языке!

### Обзор проекта
Это Telegram-бот для отслеживания личной активности, разработанный на Python. Бот позволяет пользователям определять различные типы активностей, отслеживать их выполнение (например, как чек-бокс или с замером времени) и просматривать статистику.

**Ключевые технологии:**
-   **Бот:** `aiogram`
-   **Веб-фреймворк:** `FastAPI` (для работы в режиме вебхука)
-   **База данных:** `SQLAlchemy` (асинхронный диалект `aiosqlite`)
-   **Миграции:** `Alembic`
-   **Конфигурация:** `pydantic-settings`

### Структура проекта
-   `main.py`: Точка входа в приложение. Инициализирует бота, FastAPI и регистрирует обработчики.
-   `bot/`: Логика Telegram-бота.
    -   `handlers/`: Обработчики команд и сообщений.
    -   `keyboards/`: Функции для создания клавиатур.
    -   `states/`: Состояния для FSM (Finite State Machine).
-   `core/`: Конфигурация приложения (`config.py`).
-   `db/`: Взаимодействие с базой данных (модели, CRUD-операции).
-   `PLAN.md`: Документ с планом выполнения задач и их статусом.
-   `RUNNING_INSTRUCTIONS.md`: Инструкции по запуску и настройке проекта.
-   `alembic/`: Скрипты для миграций базы данных Alembic.
-   `pyproject.toml`: Файл с зависимостями и метаданными проекта.

### Настройка и запуск

**1. Конфигурация**
Создайте файл `.env` в корне проекта и добавьте в него токен вашего бота:
```env
BOT_TOKEN="ВАШ_ТЕЛЕГРАМ_БОТ_ТОКЕН"
```
По умолчанию используется база данных SQLite с файлом `tracker.db` в корне проекта. Вы можете переопределить это, добавив переменную `DB_URL` в `.env` файл.

**2. Настройка базы данных**
Для создания таблиц в базе данных необходимо применить миграции Alembic. Убедитесь, что ваше виртуальное окружение активировано.
```bash
# Эта команда создаст/обновит файл tracker.db в соответствии с моделями
alembic upgrade head
```

**3. Запуск**
-   **Для разработки (Long Polling):**
    Этот режим удобен для локальной отладки.
    ```bash
    python -m src.main
    ```
-   **Для продакшена (Webhook):**
    Этот режим требует `uvicorn` и настроенного публичного URL.
    ```bash
    uvicorn src.main:app --host 0.0.0.0 --port 8000
    ```

### Принятые соглашения
*   **Форматирование**:
    *   Лимит строки: 100 символов.
    *   Отступы: 2 пустые строки между классами/функциями верхнего уровня, импортами.
    *   Язык: **Только Русский** (docstrings, комментарии, логи, сообщения об ошибках).
*   **Pydantic DTO**:
    *   `Field` должен содержать `examples` и `description`.
    *   Необязательные поля объявляются как `type | None = Field(None)`.
    *   Для каждой модели указывать краткую, информативную **docstring-строку** (в первой строке под объявлением класса).
*   **Python**:
    *   Используй встроенные дженерики: `list[str]`, `dict[str, int]`, `type | None` (вместо `Optional`, `List`, `Dict`).
    *   Используй `match/case` где это уместно.
*   **Асинхронность**: Весь I/O код (работа с ботом, базой данных) должен быть асинхронным (`async/await`).
*   **Обработчики**: Каждый логический блок функционала (например, добавление активности, статистика) выносится в отдельный файл в `src/bot/handlers/`.
